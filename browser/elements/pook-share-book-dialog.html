<link rel="import" href="../vendor/polymer/polymer.html">
<link rel="import" href="../vendor/paper-button/paper-button.html">
<link rel="import" href="../vendor/paper-dialog/paper-action-dialog.html">
<link rel="import" href="../vendor/paper-dialog/paper-dialog-transition.html">
<link rel="import" href="../vendor/paper-input/paper-input.html">
<link rel="import" href="../vendor/core-selector/core-selector.html">

<link rel="import" href="pook-user.html">
<link rel="import" href="pook-book-cache.html">

<!--
Book sharing dialog

Shows dialog on insertion into dom, removes itself from DOM on closure.

Usage:

    var shareDialog = document.createElement('pook-share-book-dialog');
    shareDialog.bookId = bookId
    this.shadowRoot.appendChild(shareDialog);

@element pook-share-book-dialog
@group ui
-->
<polymer-element name="pook-share-book-dialog">
  <template>
      <paper-action-dialog id="dialog" heading="Sharing {{book.data.title}}" transition="paper-dialog-transition-bottom">

       <style>
      </style>
      <template if="{{sharedWith}}">
        <div>Shared with:</div>
        <template repeat="{{uid in sharedWith}}">
          <div>{{uid}}<paper-button on-tap="stopSharing"></paper-button></div>
        </template>
      </template>
      <div>Add email of the person you'd like to share with:</div>
      <paper-input id="email" label="email" value="{{email}}" raised></paper-input>
      <paper-button on-tap="{{addShare}}" raised>Add</paper-button>

      <paper-button dismissive raised>Cancel</paper-button>
      <paper-button affirmative default raised>Done</paper-button>
    </paper-action-dialog>
  </template>
  <script>

  Polymer( {
    /**
     * @attribute bookId
     * @type <String>
     * id of book to share
     */
    publish: {
      bookId: null,
      email: null
    },
    computed: {
      book: "bookCache.books[bookId]",
      sharedWith: "computeSharedWith(book.data.sharedWith)"
    },
    ready: function() {
      this.bookCache = document.createElement('pook-book-cache');
      // remove from dom on close
      this.$.dialog.addEventListener('core-overlay-close-completed', function() {
        this.parentNode.removeChild(this);
      }.bind(this));
      this.$.dialog.open();
    },
    computeSharedWith: function(sharedIds) {
      if (sharedIds)
        return Object.keys(sharedIds);
      else
        return null;
    },
    addShare: function() {

    },
    stopSharing: function(el) {
    }
  });
  </script>
</polymer-element>
