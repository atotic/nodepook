<link href="native-promise-only.html" rel="import">
<link href="../vendor/core-animation/core-animation.html" rel="import">

<script>

(function() {
/**
  * PookPromise exposes resolve/reject methods
  * @class PookPromise
  * @group utilities
  */
  function PookPromise() {
    this.promise = new Promise(this.init.bind(this));
  }

  PookPromise.prototype = {
    init: function( resolveCb, rejectCb) {
      this.resolveCb = resolveCb;
      this.rejectCb = rejectCb;
    },
    resolve: function(val) {
      if (!this.resolveCb)
        console.error("Resolved too early");
      this.resolveCb(val);
    },
    reject: function(err) {
      if (!this.rejectCb)
        console.error("Rejected too early");
      this.rejectCb(err);
    },
    then: function(success,failure) {
      this.promise.then(success, failure);
    }
  };

/**
 * Utility functions, globals
 * @class PookUtils
 * @group utilities
 */
  PookUtils = {
    /**
     * @property firebaseLoc
     * Firebase base url global
     */
    firebaseLoc: 'https://torid-inferno-6070.firebaseio.com/',
    /**
     * @property s3url
     * s3 storage global
     */
    s3url: "http://pookio-test.s3-website-us-west-2.amazonaws.com/",
    
    /**
     * @method noop
     * null function
     */
    noop: function() {},
    /**
     * @method noope
     * noop that logs errors
     */
    noope: function(err) {
      if (err)
        console.error("Unexpected error:", err);
    },
    /**
     * @method getFirebaseUrl
     * @param {String} type user account myPhotos myBooks onePhoto oneBook allBooks allPhotos
     * @param {String} id optional
     * returns String suitable for new Firebase(str)
     */
    getFirebaseUrl: function(type, id) {
      switch(type) {
        case 'user':
          return this.firebaseLoc + "users/" + id;
        case 'account':
          return this.firebaseLoc + "users/" + id + "/account";
        case 'myPhotos':
          return this.firebaseLoc + "users/" + id + "/myPhotos";
        case 'myBooks':
          return this.firebaseLoc + "users/" + id + "/myBooks";
        case 'onePhoto': // options is photoId
          return this.firebaseLoc + "photos/" + id;
        case 'oneBook': // options is bookId
          return this.firebaseLoc + "books/" + id;
        case 'allBooks':
          return this.firebaseLoc + "books";
        case 'allPhotos':
          return this.firebaseLoc + "photos";
        default:
          throw new Error("unknown database type " + type);
      }

    },
    /**
     * @method randomString
     * @param {Number} len string length
     * @param {String} charSet optional character set
     *
     * returns a random string
     */
    randomString: function (len, charSet) {
      charSet = charSet || 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      var randomString = '';
      for (var i = 0; i < len; i++) {
          var randomPoz = Math.floor(Math.random() * charSet.length);
          randomString += charSet.substring(randomPoz,randomPoz+1);
      }
      return randomString;
    },
    
    arrayToHash: function(arry) {
      var retVal = {};
      for (var i=0; i<arry.length; i++)
        retVal[arry[i]] = i;
      return retVal;
    },

    /**
     * returns `{key: true}`
     * @method makeObjectWithBoolean
     * @param {String} key   
     */
    makeObjectWithBoolean: function(key) {
      var retVal = {};
      retVal[key] = true;
      return retVal;
    },
    
    scrollIntoView: function(element, parentElement) {
    //           var player = document.timeline.play(new Animation(element, [
    //   {opacity: "0.5", transform: "scale(0.5)"}, 
    //   {opacity: "1.0", transform: "scale(1)"}
    // ],
    // {
    //   direction: "alternate", duration: 500, iterations: Infinity
    // }));
    //           return;
      if (parentElement == null)
        parentElement = element.parentNode;
      var target = {
        top: element.offsetTop,
        bottom: element.offsetTop + element.offsetHeight
      };
      var parent = {
        top: parentElement.scrollTop,
        bottom: parentElement.scrollTop + parentElement.offsetHeight
      };
      var dest = 0;
      if (target.top < parent.top)
        dest = target.top - 4;
      else if (target.bottom > parent.bottom)
        dest = target.bottom - parentElement.offsetHeight + 8;
      if (dest != 0) {
        var startScrollTop = parentElement.scrollTop;
        var animation = new CoreAnimation();
        animation.duration = Math.abs(dest - startScrollTop) / 3;
        animation.target = parentElement;
        animation.easing = "easeInOutQuart";
        animation.customEffect = function(timeFraction, target, animation) 
          {
            target.scrollTop = startScrollTop + (dest - startScrollTop) * timeFraction;
          };
        animation.play();
      }
      else {
        console.log('element already visible');
      }
    }
  }

  window.PookPromise = PookPromise;
  window.PookUtils = PookUtils;

})();
</script>
